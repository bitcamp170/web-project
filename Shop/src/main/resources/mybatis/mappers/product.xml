<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mappers.product">

	<resultMap id="productResult" type="productVO">
		<result property="product_id" column="product_id" />  
		<result property="product_name" column="product_name" />
		<result property="product_detail" column="product_detail" />
		<result property="sales_unit" column="sales_unit" />
		<result property="product_size" column="product_size" />
		<result property="packing_type" column="packing_type" />
		<result property="product_image" column="product_image" />
		<result property="supplier" column="supplier" />
		
		<result property="product_category_num" column="product_category_num" />
		<result property="product_category_name" column="product_category_name" />
		
		<result property="option_name" column="option_name" />
		<result property="option_price" column="option_price" />
		<result property="option_quantity" column="option_quantity" />
		
		<result property="item_num" column="item_num" />
		<result property="price" column="price" />
		<result property="stock" column="stock" />
		<result property="sales" column="sales" />
		<result property="discount" column="discount" />
		<result property="reg_date" column="reg_date" />
		<result property="unit_price" column="unit_price" />
		
		
	</resultMap>	
	
	
	<!-- 아진 -->
	<select id="selectGoodsList" parameterType="java.util.HashMap" resultMap="productResult"   >
        <![CDATA[
        	SELECT *
        	FROM ( SELECT ROWNUM R_NUM, C.*
        			FROM (select p.*, i.price, i.discount, i.reg_date 
        					from product p, item i
          ]]>
        	where p.product_id=i.product_id 
        	and product_Category_Num=#{product_category_num}
            <choose>
            	<when test="listKey == 'reg_date'" >
            		order by reg_date desc )C )
            	</when>
            	<when test="listKey == 'price' and orderKey == 'desc' " >
            		order by price desc ) C )
            	</when>
            	<when test="listKey == 'price' and orderKey == 'asc'" >
            		order by price asc ) C )
            	</when>
	  		</choose>
	  		WHERE R_NUM BETWEEN #{begin} and #{end}
	</select>
	
	<select id="selectProductCategoryName" parameterType= "int" resultType ="String">
		<![CDATA[
			SELECT product_category_name FROM PRODUCT_CATEGORY 
			WHERE product_category_num = #{product_category_num} 
		]]>
	</select>
	
	<select id="totalCount" parameterType="int" resultType="int">
		SELECT COUNT(*)
		FROM PRODUCT
		WHERE PRODUCT_CATEGORY_NUM = #{product_category_num}	
	</select>
	
	<select id="selectProductDetail" resultType="productVO"   parameterType="String"  >
	    <![CDATA[
		    select p.*, i.item_num, i.price, i.discount
 			from product p, item i
	        where p.product_id = i.product_id 
        	and p.product_id= #{product_id}
    	]]>
	</select>
	
	<select id="selectOption" resultMap = "productResult" parameterType="String">
		<![CDATA[
			SELECT * FROM product_option
			WHERE PRODUCT_ID=#{product_id}
		]]>
	</select>
	
	
	<!-- 상연 -->
	<select id="bestList" resultType="productVO">
		select * from product p , item i where p.product_id=i.product_id order by i.sales desc
	</select>
	
	<select id="newList" resultType="productVO">
		select * from product p , item i where p.product_id=i.product_id order by i.reg_date desc
	</select>
	
	<insert id="insertProduct" parameterType="productVO">
		<![CDATA[
			insert into product (product_id,product_name,product_detail,sales_unit,product_size,packing_type,product_image,supplier,product_category_num)
			values(#{product_id},#{product_name},#{product_detail},#{sales_unit},#{product_size},#{packing_type},#{product_image},#{supplier},${product_category_num})
		]]>
	</insert>
	
	<insert id="insertProductCategory" parameterType="productVO">
		<![CDATA[
			insert into product_category (product_category_num,product_category_name)
			values(#{product_category_num},#{product_category_name})
		]]>
	</insert>
	
	<insert id="insertProductOption" parameterType="productVO">
		<![CDATA[
			insert into product_option (option_name,option_price,option_quantity,product_id)
			values(#{option_name},#{option_price},#{option_quantity},#{product_id})
		]]>
	</insert>
	
	<insert id="insertItem" parameterType="productVO">
		<![CDATA[
			insert into item (item_num,price,stock,sales,discount,reg_date,unit_price,product_id)
			values(#{item_num},#{price},#{stock},#{sales},#{discount},#{reg_date},#{unit_price},#{product_id})
		]]>
	</insert>
	
</mapper>