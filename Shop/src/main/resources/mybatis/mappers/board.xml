<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.board">

	<!-- 공지사항 전체 목록 불러오기 -->
	<select id="getNoticeList" parameterType="map" resultType="boardVO">
		SELECT *
		FROM (SELECT ROWNUM R_NUM, N.*
      		  FROM (SELECT *
            		FROM NOTICE
            		ORDER BY NOTICE_NUM DESC
             	    ) N
     		 )
		WHERE R_NUM BETWEEN #{begin} AND #{end}
	</select>

	<!-- 공지사항 선택한 글 상세 불러오기 -->
	<select id="getNotice" parameterType="boardVO" resultType="boardVO">
		SELECT *
		FROM NOTICE
		WHERE NOTICE_NUM = #{notice_num}
	</select>

	<!-- FAQ 전체 목록 불러오기 -->
	<select id="getFAQList" parameterType="map" resultType="boardVO">
		SELECT * 
		FROM (SELECT ROWNUM R_NUM, A.*
			  FROM (SELECT F.FAQ_NUM, Q.QNA_CATEGORY_NAME, F.TITLE, F.CONTENTS  
			  		FROM FAQ F, QNA_CATEGORY Q 
					WHERE f.qna_category_num = q.qna_category_num 
					ORDER BY f.faq_num) A)
		WHERE R_NUM BETWEEN #{begin} AND #{end}
	</select>
	
	<!-- FAQ 선택한 글 상세 불러오기 -->
	<select id="getFAQ" parameterType="boardVO" resultType="boardVO">
		SELECT F.FAQ_NUM , Q.QNA_CATEGORY_NAME , F.TITLE, F.CONTENTS
		FROM FAQ F, QNA_CATEGORY Q
		WHERE f.qna_category_num = q.qna_category_num
		AND f.faq_num = #{faq_num}
	</select>
	
	<!-- 1:1 문의 전체 목록 불러오기 -->
	<select id="getMemQList" parameterType="map" resultType="boardVO">
		SELECT * FROM 
			(SELECT ROWNUM R_NUM, A.* FROM 
			(SELECT member_qna_num, title, contents, image, qna_category_name, 
			order_num, member_id, email, phone, reg_date 
			FROM MEMBER_QNA Q, QNA_CATEGORY C 
			WHERE Q.qna_category_num = C.qna_category_num 
			ORDER BY Q.member_qna_num DESC) A)
		WHERE R_NUM BETWEEN #{begin} AND #{end}
	</select>
	
<!-- 1:1 문의 선택한 글 상세 불러오기 -->
	<select id="getMemQ" parameterType="boardVO" resultType="boardVO">
		SELECT member_qna_num, title, contents, image, qna_category_name, 
			order_num, member_id, email, phone, reg_date 
		FROM MEMBER_QNA Q, QNA_CATEGORY C 
		WHERE Q.qna_category_num = C.qna_category_num 
		and Q.member_qna_num = #{member_qna_num}
	</select>

	<!-- 1:1 문의 insert문 -->
	<insert id="memqInsert" parameterType="boardVO">
		INSERT INTO MEMBER_QNA VALUES 
		((SELECT NVL(MAX(MEMBER_QNA_NUM),0) + 1 FROM MEMBER_QNA), 
		#{title}, #{contents}, 
		#{image}, 2, #{order_num}, 
		(SELECT MEMBER_ID FROM MEMBER WHERE MEMBER_ID = #{member_id}), 
		#{email}, #{phone}, SYSDATE)
	</insert>
	
	<!-- 1:1 문의 update문 -->
	<update id="memqUpdate" parameterType="boardVO">
		UPDATE MEMBER_QNA 
		SET TITLE = #{title}, 
		CONTENTS = #{contents}, 
		IMAGE = #{image}, 
		QNA_CATEGORY_NUM = 1, 
		ORDER_NUM = #{order_num}, 
		EMAIL = #{email}, 
		PHONE = #{phone}, 
		REG_DATE = SYSDATE 
		WHERE MEMBER_QNA_NUM = #{member_qna_num}
	</update>

	<!-- 공지사항 게시글 갯수 조회 -->
	<select id="getNoticeCount" resultType="int">
		SELECT COUNT(*) 
		FROM NOTICE
	</select>
	
	<!-- FAQ 게시글 갯수 조회 -->
	<select id="getFAQCount" resultType="int">
		SELECT COUNT(*) 
		FROM FAQ
	</select>
	
	<!-- 회원 1:1 문의 (member_qna) 게시글 갯수 조회 -->
	<select id="getMemQCount" resultType="int">
		SELECT COUNT(*) 
		FROM MEMBER_QNA
	</select>

</mapper>