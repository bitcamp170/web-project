<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.board">
<!-- **************************************************** 전체 목록 **************************************************** -->
	
	<!-- 공지사항 -->
	<select id="getNoticeList" parameterType="hashmap" resultType="boardVO">
		SELECT *
		FROM (SELECT ROWNUM R_NUM, N.*, 
					 LEAD(notice_num, 1) OVER (ORDER BY notice_num DESC) AS PRE_NO, 
					 LAG(notice_num, 1) OVER (ORDER BY notice_num DESC) AS NEXT_NO 
			  FROM (SELECT * 
			  		FROM NOTICE 
			  		ORDER BY NOTICE_NUM DESC
			  		) N 
			  )
		WHERE R_NUM BETWEEN #{paging.begin} AND #{paging.end}
	</select>

	<!-- FAQ -->
	<select id="getFAQList" parameterType="hashmap" resultType="boardVO">
		SELECT * 
		FROM (SELECT ROWNUM R_NUM, A.*, 
					 LEAD(FAQ_NUM, 1) OVER (ORDER BY FAQ_NUM DESC) AS PRE_NO, 
					 LAG(FAQ_NUM, 1) OVER (ORDER BY FAQ_NUM DESC) AS NEXT_NO 
			  FROM (SELECT F.FAQ_NUM, Q.QNA_CATEGORY_NAME, F.TITLE, F.CONTENTS  
			  		FROM FAQ F, QNA_CATEGORY Q 
					WHERE f.qna_category_num = q.qna_category_num 
					ORDER BY f.faq_num DESC) A) 
		WHERE R_NUM BETWEEN #{paging.begin} AND #{paging.end}
	</select>
	
	<!-- 1:1 문의(관리자용) 전체 -->
	<select id="getMemQListAll" parameterType="hashmap" resultType="boardVO">
		SELECT * FROM 
			(SELECT ROWNUM R_NUM, A.*, 
					LEAD(member_qna_num, 1) OVER (ORDER BY member_qna_num DESC) AS PRE_NO, 
					LAG(member_qna_num, 1) OVER (ORDER BY member_qna_num DESC) AS NEXT_NO 
			FROM 
			(SELECT member_qna_num, title, contents, image1, image2, image3, qna_category_name, 
			order_num, member_id, email, phone, reg_date 
			FROM MEMBER_QNA Q, QNA_CATEGORY C 
			WHERE Q.qna_category_num = C.qna_category_num 
			ORDER BY Q.member_qna_num DESC) A)
		WHERE R_NUM BETWEEN #{paging.begin} AND #{paging.end}
	</select>
	
	<!-- 1:1 문의 로그인회원 -->
	<select id="getMemQList" parameterType="hashmap" resultType="boardVO">
		SELECT * FROM 
			(SELECT ROWNUM R_NUM, A.*, 
					LEAD(member_qna_num, 1) OVER (ORDER BY member_qna_num DESC) AS PRE_NO, 
					LAG(member_qna_num, 1) OVER (ORDER BY member_qna_num DESC) AS NEXT_NO 
			FROM 
			(SELECT member_qna_num, title, contents, image1, image2, image3, qna_category_name, 
			order_num, member_id, email, phone, reg_date 
			FROM MEMBER_QNA Q, QNA_CATEGORY C 
			WHERE Q.qna_category_num = C.qna_category_num 
			AND q.member_id = #{member_id}
			ORDER BY Q.member_qna_num DESC) A)
		WHERE R_NUM BETWEEN #{paging.begin} AND #{paging.end}
	</select>

<!-- ****************************************** 선택한 글 상세 보기 ****************************************** -->

	<!-- 공지사항 선택한 글 불러오기 -->
	<select id="getNotice" parameterType="boardVO" resultType="boardVO">
		SELECT *
		FROM NOTICE
		WHERE NOTICE_NUM = #{notice_num}
	</select>
	
	<!-- FAQ 선택한 글 불러오기 -->
	<select id="getFAQ" parameterType="boardVO" resultType="boardVO">
		SELECT F.FAQ_NUM , Q.QNA_CATEGORY_NAME , F.TITLE, F.CONTENTS
		FROM FAQ F, QNA_CATEGORY Q
		WHERE f.qna_category_num = q.qna_category_num
		AND f.faq_num = #{faq_num}
	</select>
	
	<!-- 1:1 문의 선택한 글 불러오기 -->
	<select id="getMemQ" parameterType="boardVO" resultType="boardVO">
		SELECT member_qna_num, title, contents, image1, image2, image3, qna_category_name, 
			order_num, member_id, email, phone, reg_date 
		FROM MEMBER_QNA Q, QNA_CATEGORY C 
		WHERE Q.qna_category_num = C.qna_category_num 
		and Q.member_qna_num = #{member_qna_num}
		and Q.member_id = #{member_id}
	</select>
	
<!-- ****************************************** insert ****************************************** -->

	<!-- 관리자 공지사항 -->
	<insert id="noticeInsert" parameterType="hashmap">
		INSERT INTO NOTICE VALUES 
		((SELECT NVL(MAX(NOTICE_NUM),0) + 1 FROM NOTICE), 
		#{title}, #{contents}, SYSDATE, 0, #{image1}, #{image2}, #{image3})
	</insert>
	
	<!-- 관리자 FAQ -->
	<insert id="faqInsert" parameterType="boardVO">
		INSERT INTO FAQ VALUES 
		((SELECT NVL(MAX(FAQ_NUM),0) + 1 FROM FAQ), 
		#{qna_category_num}, #{title}, #{contents})
	</insert>

	<!-- 1:1 문의 -->
	<insert id="memqInsert" parameterType="hashmap">
		INSERT INTO MEMBER_QNA VALUES 
		((SELECT NVL(MAX(MEMBER_QNA_NUM),0) + 1 FROM MEMBER_QNA), 
		#{title}, #{contents}, 
		#{image1}, #{qna_category_num}, #{order_num}, 
		(SELECT MEMBER_ID FROM MEMBER WHERE MEMBER_ID = #{member_id}), 
		#{email}, #{phone}, SYSDATE, #{image2}, #{image3})
	</insert>
	
<!-- ****************************************** update ****************************************** -->
	
	<!-- 1:1 문의 update문 -->
	<update id="memqUpdate" parameterType="hashmap">
		UPDATE MEMBER_QNA 
		SET TITLE = #{title}, 
		CONTENTS = #{contents}, 
		IMAGE1 = #{image1}, 
		IMAGE2 = #{image2}, 
		IMAGE3 = #{image3}, 
		ORDER_NUM = #{order_num}, 
		QNA_CATEGORY_NUM = #{qna_category_num}, 
		REG_DATE = SYSDATE 
		WHERE MEMBER_QNA_NUM = #{member_qna_num}
		AND MEMBER_ID = #{member_id}
	</update>
	
	<!-- 공지사항 update문 -->
	<update id="noticeUpdate" parameterType="hashmap">
		UPDATE NOTICE 
		SET TITLE = #{title}, 
		CONTENTS = #{contents}, 
		IMAGE1 = #{image1}, 
		IMAGE2 = #{image2}, 
		IMAGE3 = #{image3}, 
		REG_DATE = SYSDATE 
		WHERE NOTICE_NUM = #{notice_num}
	</update>
	
	<!-- FAQ update문 -->
	<update id="faqUpdate" parameterType="hashmap">
		UPDATE FAQ 
		SET TITLE = #{title}, 
		CONTENTS = #{contents}, 
		QNA_CATEGORY_NUM = #{qna_category_num} 
		WHERE FAQ_NUM = #{faq_num}
	</update>

<!-- ****************************************** 게시판 글 개수 조회 ****************************************** -->

	<!-- 공지사항 -->
	<select id="getNoticeCount" resultType="int">
		SELECT COUNT(*) 
		FROM NOTICE
	</select>
	
	<!-- FAQ -->
	<select id="getFAQCount" resultType="int">
		SELECT COUNT(*) 
		FROM FAQ
	</select>
	
	<!-- 회원 1:1 로그인회원  -->
	<select id="getMemQCount" parameterType="memberVO" resultType="int">
		SELECT COUNT(*) 
		FROM MEMBER_QNA
		WHERE MEMBER_ID = #{member_id}
	</select>
	
	<!-- 회원 1:1 문의 전체 -->
	<select id="getMemQCountAll" resultType="int">
		SELECT COUNT(*)
		FROM MEMBER_QNA
	</select>
	
<!-- ****************************************** delete ****************************************** -->
	
	<!-- 공지사항 delete문 -->
	<delete id="noticeDelete" parameterType="boardVO">
		DELETE FROM NOTICE WHERE NOTICE_NUM = ${notice_num}
	</delete>
	
	<!-- FAQ delete문 -->
	<delete id="faqDelete" parameterType="boardVO">
		DELETE FROM FAQ WHERE FAQ_NUM = ${faq_num}
	</delete>
	
</mapper>